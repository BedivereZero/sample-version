#!/bin/bash

set -o errexit
set -o nounset
set -o pipefail


SAMPLE_ROOT="$(dirname "${BASH_SOURCE[0]}")/.."
source "${SAMPLE_ROOT}/build/lib/version.sh"

sample::lib::version::get_version_vars

cat <<EOF
STABLE_BUILD_GIT_COMMIT ${SAMPLE_GIT_COMMIT-}
STABLE_BUILD_SCM_STATUS ${SAMPLE_GIT_TREE_STATE-}
STABLE_BUILD_SCM_REVISION ${SAMPLE_GIT_VERSION-}
STABLE_BUILD_MAJOR_VERSION ${SAMPLE_GIT_MAJOR-}
STABLE_BUILD_MINOR_VERSION ${SAMPLE_GIT_MINOR-}
STABLE_DOCKER_TAG ${SAMPLE_GIT_VERSION/+/_}
STABLE_DOCKER_REGISTRY ${SAMPLE_DOCKER_REGISTRY:-k8s.gcr.io}
STABLE_DOCKER_PUSH_REGISTRY ${SAMPLE_DOCKER_PUSH_REGISTRY:-${SAMPLE_DOCKER_REGISTRY:-staging-k8s.gcr.io}}
gitCommit ${SAMPLE_GIT_COMMIT-}
gitTreeState ${SAMPLE_GIT_TREE_STATE-}
gitVersion ${SAMPLE_GIT_VERSION-}
gitMajor ${SAMPLE_GIT_MAJOR-}
gitMinor ${SAMPLE_GIT_MINOR-}
buildDate $(date \
  ${SOURCE_DATE_EPOCH:+"--date=@${SOURCE_DATE_EPOCH}"} \
   -u +'%Y-%m-%dT%H:%M:%SZ')
EOF

#!/bin/bash

set -o errexit
set -o nounset
set -o pipefail

REPO_ROOT="$(dirname "${BASH_SOURCE[0]}")/.."
source "${REPO_ROOT}/build/lib/version.sh"

sample::lib::version::get_version_vars

LDFLAGS="-w -s"
LDFLAGS+=" -X main.version=${GIT_VERSION}"
LDFLAGS+=" -X main.gitCommit=${GIT_COMMIT}"
LDFLAGS+=" -X main.gitTreeState=${GIT_TREE_STATE}"

go build \
  -o output/bin/version \
  -ldflags "${LDFLAGS}" \
  github.com/BedivereZero/sample-version/cmd/version
